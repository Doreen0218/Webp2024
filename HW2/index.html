<h1>景點觀光展覽資訊    <input type="text" id="searchBox" onkeyup="searchData()" placeholder="搜尋..."></h1>

<style>
        table {
            font-family: Arial, Helvetica, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }
        td, th {
            border: 1px solid #ddd;
            padding: 6px;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #ddd;
        }
        th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #04AA6D;
            color: white;
        }
        
    </style>

<table id="csie" class="table table-striped table-hover">
  <tr>
    <th>名稱</th>
    <th>地點</th>
    <th>票價</th> 
  </tr>
</table>

<div id="pagination">
  <button onclick="changePage(-1)">上一頁</button>
  <span id="pageInfo"></span>
  <button onclick="changePage(1)">下一頁</button>
</div>

<script>
var currentPage = 0;
var itemsPerPage = 10;
var datasetGlobal = [];
var searchQuery = '';

function loadData() {
  var xhr = new XMLHttpRequest();
  xhr.open('GET', "https://cloud.culture.tw/frontsite/trans/SearchShowAction.do?method=doFindTypeJ&category=6", true);
  xhr.onreadystatechange = function() {
    if (xhr.readyState == 4 && xhr.status == 200) {
      datasetGlobal = JSON.parse(xhr.responseText);
      applySearch(); // 应用搜索并初始化分页
    }
  };
  xhr.send();
}

function applySearch() {
  var filteredData = searchQuery
    ? datasetGlobal.filter(function(data) {
      return data['title'].toUpperCase().includes(searchQuery.toUpperCase());
    })
    : datasetGlobal;
  updatePagination(filteredData.length);
  addNewData(filteredData);
}

function searchData() {
  searchQuery = document.getElementById("searchBox").value;
  currentPage = 0; // 重置回第一頁
  applySearch();
}

function addNewData(dataset) {
  var myTable = document.getElementById("csie");
  while (myTable.rows.length > 1) myTable.deleteRow(1);
  var startItem = currentPage * itemsPerPage;
  var endItem = startItem + itemsPerPage;
  var pagedData = dataset.slice(startItem, endItem);
  pagedData.forEach(function(data) {
    var row = myTable.insertRow();
    row.insertCell(0).innerHTML = data['title'];
    row.insertCell(1).innerHTML = data['showInfo'][0]['location'];
    row.insertCell(2).innerHTML = data['showInfo'][0]['price'];
  });
}

function changePage(move) {
  var newPage = currentPage + move;
  var totalPages = Math.ceil(datasetGlobal.length / itemsPerPage);
  if (newPage < 0 || newPage >= totalPages) return;
  currentPage = newPage;
  applySearch();
}

function updatePagination(totalItems) {
  var totalPages = Math.ceil(totalItems / itemsPerPage);
  document.getElementById("pageInfo").textContent = '第 ' + (currentPage + 1) + ' / ' + totalPages + ' 頁';
}

document.addEventListener('DOMContentLoaded', loadData);
</script>
